# 植物観察日記システム 仕様書

## 1. システム概要

USBカメラで撮影した植物の画像を元に、Gemini APIを用いて日記を自動生成し、Webサイトとして閲覧可能にするセルフホスト型システム。

## 2. システム構成

### 2.1 実行環境

* **ホストOS**: Linux (Ubuntu/Debian等)
* **コンテナ基盤**: Docker / Docker Compose
* **バックアップ先**: 自宅NAS (NFS/SMBマウント想定)

### 2.2 技術スタック

* **言語**: Go (Golang)
* **データベース**: SQLite 3
* **AIエンジン**: Google Gemini 1.5 Flash (API)
* **カメラ制御**: fswebcam (ホスト側Cron実行)

---

## 3. ディレクトリ構造

```text
.
├── docker-compose.yml
├── app/                # Go ソースコード
├── data/               # 永続データ（共有ボリューム）
│   ├── photos/         # 植物画像ファイル (.jpg)
│   └── plant_log.db    # SQLite データベース
└── scripts/
    └── capture.sh      # 撮影用スクリプト (ホスト側)

```

---

## 4. 機能仕様

### 4.1 画像撮影プロセス (Host側)

1. **トリガー**: Cronによる定期実行（例：毎日 12:00）。
2. **処理**:
* `fswebcam` 等を用いてUSBカメラから撮影。
* `data/photos/YYYYMMDD_HHMM.jpg` 形式で保存。
* 撮影成功後、Dockerコンテナ内の処理をキック（または共有ディレクトリを監視）。



### 4.2 日記生成プロセス (Worker側)

1. **新着検知**: `data/photos/` に未処理の画像があるか確認。
2. **AI解析**:
* 画像を Gemini API (Vision機能) に送信。
* 「成長の様子」や「変化」にフォーカスした日記を生成。


3. **DB保存**:
* 画像パス、日記本文、生成日時をSQLiteに記録。



### 4.3 Web公開機能 (Server側)

1. **一覧表示**: 過去の日記をカレンダー逆順（新着順）でリスト表示。
2. **詳細表示**: 高解像度画像と日記本文の閲覧。
3. **レスポンシブ対応**: スマートフォンからの閲覧を考慮した簡易デザイン。

---

## 5. データモデル (SQLite)

### Table: `diary`

| カラム名 | 型 | 説明 |
| --- | --- | --- |
| `id` | INTEGER | プライマリキー（連番） |
| `image_path` | TEXT | 保存された画像の相対パス |
| `content` | TEXT | Geminiが生成した日記本文 |
| `created_at` | DATETIME | レコード作成日時 |

---

## 6. 運用・バックアップ

* **DBバックアップ**: SQLiteファイルが単一のため、`data/` ディレクトリを丸ごとNASへ `rsync` または `cp` するだけで完了。
* **環境変数の管理**: Gemini APIキーなどの機密情報は `.env` ファイルで管理。

