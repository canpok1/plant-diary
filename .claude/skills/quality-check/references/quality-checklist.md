# 品質チェックリスト

AIが成果物の品質をレビューする際に使用するチェックリストです。

**前提**: linterでチェック可能な項目（gofmt, golangci-lint等）は自動チェックに任せます。
このリストは、人間の判断が必要な設計・実装パターンのみを対象とします。

**注意**: コミットメッセージは品質チェックの対象外です（開発者の責任範囲）。

## 1. インターフェース設計

- [ ] **単一責任**: 1つのインターフェースは1つの責務に集中しているか
- [ ] **小さいインターフェース**: メソッド数は適切か（理想は1-3）
- [ ] **context.Context**: 最初の引数に配置されているか
- [ ] **適切な抽象化**: インターフェースが実装詳細に依存していないか

詳細は `docs/rules/go-style-guide.md` を参照。

## 2. エラーハンドリング

- [ ] **エラーチェック**: すべてのエラーが適切に処理されているか
- [ ] **エラーラッピング**: `fmt.Errorf` + `%w` でコンテキスト情報を追加しているか
- [ ] **エラーメッセージ**: 小文字開始、簡潔、具体的か

```go
// 良い例
if err := storage.CreateEntry(ctx, entry); err != nil {
    return fmt.Errorf("failed to create entry: %w", err)
}

// 悪い例
storage.CreateEntry(ctx, entry)  // エラー無視
return err  // コンテキスト情報なし
```

## 3. テスト

- [ ] **カバレッジ**: 主要な機能パスがカバーされているか
- [ ] **エッジケース**: 境界値やエラーケースがテストされているか
- [ ] **テーブル駆動**: 複数ケースを効率的にテストしているか
- [ ] **モック**: 外部依存が適切にモック化されているか

```bash
# カバレッジ確認
go test -cover ./...
```

## 4. セキュリティ

- [ ] **入力検証**: ユーザー入力が検証されているか
- [ ] **パストラバーサル**: ファイルパスが検証されているか
- [ ] **機密情報**: ハードコードされた認証情報がないか
- [ ] **エラー情報**: 詳細すぎる情報を外部に漏らしていないか

```go
// パストラバーサル対策の例
cleanPath := filepath.Clean(userPath)
if !strings.HasPrefix(cleanPath, "/safe/directory/") {
    return errors.New("invalid path")
}
```

## 5. パフォーマンス

- [ ] **context.Context**: タイムアウト・キャンセル処理が実装されているか
- [ ] **ゴルーチンリーク**: ゴルーチンが適切に終了しているか
- [ ] **N+1問題**: データベースクエリのN+1問題がないか
- [ ] **不要なアロケーション**: 明らかな非効率がないか

## 6. 依存関係管理

- [ ] **go.mod**: 依存関係が適切に記録されているか
- [ ] **go.sum**: チェックサムが更新されているか
- [ ] **不要な依存**: 使用していない依存関係がないか

```bash
# 依存関係の整理
go mod tidy
```

## レビュー手順

1. **変更内容の確認**: `git diff` または `git show`
2. **linterチェック**: `golangci-lint run`（自動チェック）
3. **テスト実行**: `go test ./...`
4. **このチェックリストで設計・実装パターンを確認**
5. **問題があればフィードバック**: `SendMessage` で具体的な改善点を伝える

## 参考資料

- `docs/rules/go-style-guide.md`: Go言語スタイルガイド（設計パターン詳細）
- `docs/rules/commit-message-guide.md`: コミットメッセージガイド（開発者向け）
